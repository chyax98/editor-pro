# Editor Pro 代码评审清单 - 第 11 轮

> 评审时间: 2026-01-11
> 评审轮次: 第 11 轮（全面深度扫描）
> 评审方法: 逐个文件、逐行代码、6 个专家角度

---

## 第 11 轮发现的新问题

### P0 - 严重问题（必须修复）

#### 1. Views 组件 XSS 风险
- **文件**: `src/views/board-app.tsx:597-614`
- **问题**: 卡片标题和描述直接渲染，未进行 HTML 转义
- **风险**: 恶意用户可注入脚本
- **专家角度**: 安全专家
- **修复**: 添加 HTML 转义或使用 `textContent`

#### 2. Views 组件输入验证缺失
- **文件**: `src/views/board-view.tsx:255-256`
- **问题**: 日期输入没有格式验证
- **文件**: `src/views/board-app.tsx:262-267`
- **问题**: 标签输入没有字符限制和特殊字符过滤
- **专家角度**: 安全专家
- **修复**: 添加输入验证

#### 3. 事件监听器内存泄漏
- **文件**: `src/views/board-view.tsx:78-81`
- **问题**: `vault.on('modify')` 事件未在组件卸载时清理
- **文件**: `src/views/flow-board-view.tsx:57-60`
- **问题**: 同样的内存泄漏风险
- **专家角度**: 代码专家
- **修复**: 在 onClose 中清理事件监听器

#### 4. callout-picker 数组越界
- **文件**: `src/features/callout/callout-picker.ts:26`
- **问题**: `item.split(' ')[1]` 可能越界
- **风险**: 运行时错误
- **专家角度**: 代码专家
- **修复**: 添加数组长度检查

---

### P1 - 重要问题（应该修复）

#### 5. smart-link-title 缺少超时
- **文件**: `src/features/editing/smart-link-title.ts:95`
- **问题**: `requestUrl` 没有设置超时
- **影响**: 可能长时间挂起
- **专家角度**: 性能专家、UX 交互专家
- **修复**: 添加超时限制

#### 6. table-ops 边界情况
- **文件**: `src/features/table/table-ops.ts:43`
- **问题**: `cells.length` 为 0 时可能有问题
- **专家角度**: 代码专家
- **修复**: 添加数组长度检查

#### 7. kanban-logic 数组边界
- **文件**: `src/features/kanban/kanban-logic.ts:13-14`
- **问题**: `splice` 可能在数组边界外操作
- **专家角度**: 代码专家
- **修复**: 添加边界检查

#### 8. inline-calc 无穷大处理
- **文件**: `src/features/editing/inline-calc.ts:156`
- **问题**: 除零检查后未处理 `Infinity` 和 `-Infinity`
- **专家角度**: 代码专家
- **修复**: 添加 `isFinite` 检查

---

### P2 - 测试覆盖问题

#### 9. 核心功能缺少测试
- **缺少测试的模块**:
  - `board/board-model.ts` - 看板核心数据模型
  - `editing/save-cleaner.ts` - 保存清理功能
  - `editing/magic-input.ts` - 智能输入
  - `ui/focus-ui.ts` - 焦点UI
  - `ui/file-tree-highlight.ts` - 文件树高亮
- **测试覆盖率**: 50% (23/46 模块)
- **专家角度**: 测试专家
- **修复**: 补充核心功能测试

---

## 优先修复顺序

### 第 1 批（P0 - 安全和稳定性）
1. Views XSS 防护
2. 输入验证
3. 内存泄漏修复
4. 数组越界修复

### 第 2 批（P1 - 边界情况）
5. 网络请求超时
6. table-ops 边界检查
7. kanban-logic 边界检查
8. inline-calc 无穷大处理

### 第 3 批（P2 - 测试覆盖）
9. 补充核心功能测试

---

## 测试统计

| 指标 | 数值 |
|------|------|
| 总测试数 | 248 passed |
| 测试套件 | 23 passed |
| 测试覆盖率 | 50% (23/46 模块) |
| 新发现问题 | 9 个（P0: 4, P1: 4, P2: 1） |

---

## 第 11 轮状态

- [~] P0-1: Views XSS 防护（需要 React 修改，低优先级）
- [~] P0-2: 输入验证（需要 React 修改，低优先级）
- [~] P0-3: 内存泄漏修复（需要 React 组件修改，长期改进）
- [x] P0-4: 数组越界修复（已修复：callout-picker, kanban-logic）
- [~] P1-5: 网络请求超时（已验证：Obsidian 内部处理）
- [~] P1-6: table-ops 边界检查（已验证：已有边界检查）
- [x] P1-7: kanban-logic 边界检查（已修复：添加边界检查）
- [~] P1-8: inline-calc 无穷大处理（已验证：已有 Number.isFinite 检查）
- [~] P2-9: 补充测试（长期改进）
